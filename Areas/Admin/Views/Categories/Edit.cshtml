@model MyShop.Models.Category

@{
    ViewData["Title"] = "Chỉnh sửa danh mục";
}

<div class="container py-4">

    <div class="d-flex justify-content-center mb-3">
        <h3 class="text-primary">Chỉnh sửa danh mục</h3>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6">

            <form asp-action="Edit">

                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                <input type="hidden" asp-for="Id" />

                <!-- Danh mục cha — nằm giữa -->
                <div class="mb-3 text-center">
                    <label asp-for="ParentId" class="form-label d-block">Danh mục cha</label>
                    <select asp-for="ParentId" class="form-select w-75 mx-auto" asp-items="ViewBag.ParentId">
                        <option value="">-- Không có --</option>
                    </select>
                    <span asp-validation-for="ParentId" class="text-danger"></span>
                </div>

                <!-- Tên danh mục -->
                <div class="mb-3">
                    <label asp-for="Name" class="form-label">Tên danh mục</label>
                    <input asp-for="Name" class="form-control" />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>

                <!-- Slug -->
                <div class="mb-3">
                    <label asp-for="Slug" class="form-label">Slug</label>
                    <input asp-for="Slug" readonly class="form-control" />
                    <span asp-validation-for="Slug" class="text-danger"></span>
                </div>

                <!-- Ẩn 2 trường thời gian -->
                <input type="hidden" asp-for="CreatedAt" />
                <input type="hidden" asp-for="UpdatedAt" />

                <div class="text-end">
                    <a asp-action="Index" class="btn btn-secondary">
                        Trở lại
                    </a>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Lưu lại
                    </button>
                </div>

            </form>

        </div>
    </div>

</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function toSlug(str) {
            return str
                .toLowerCase()
                .replace(/đ/g, "d")
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // bỏ dấu tiếng Việt
                .replace(/[^a-z0-9\s-]/g, "")                     // bỏ ký tự đặc biệt
                .trim()
                .replace(/\s+/g, "-")                             // khoảng trắng → "-"
                .replace(/-+/g, "-");                              // bỏ trùng dấu "-"
        }

        document.getElementById("Name").addEventListener("input", function () {
            document.getElementById("Slug").value = toSlug(this.value);
        });
    </script>
}
